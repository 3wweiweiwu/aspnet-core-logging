# Build ASP.NET Core project using Azure Pipelines.
# See more here: https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core?view=vsts.
# YAML schema reference: https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=schema.

# Specify build number format.
# See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/build/options?view=vsts&tabs=yaml#build-number-format.
name: $(SourceBranchName)_$(Date:yyyyMMdd).$(Rev:rrr)

resources:
  repositories: 
  # See more about repositories here: https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=schema#repository.
  - repository: aspnet_core_logging
    type: github
    name: satrapu/aspnet-core-logging
    clean: True
    # The value of the "endpoint" element must match the service connection name 
    # declared in Project Settings -> Service connections section of your Azure DevOps organization
    endpoint: satrapu

# Build multiple branches.
# See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/build/ci-build-git?view=vsts&tabs=yaml.
trigger:
 - master
 - feature/*
 - bugfix/*
 - hotfix/*
 - release/*

# See more about Azure Pipelines variables here: https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=vsts.
variables:
  # Load group containing variables applicable to all pipelines belonging to this project.
  - group: GlobalVariables

  # Load SonarQube related variable group.
  # See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups?view=vsts&tabs=yaml#use-a-variable-group.
  # Be sure to link this group to this pipeline by selecting the latter -> Edit -> Variables -> Variable Groups!
  - group: SonarQube

  # Specifies the version of the .NET Core SDK to install and use when running this pipeline
  - name: 'DotNetCore_SDK_Version'
    value: '2.2.101'

  # Specifies the version of the ReportGenerator tool used for generaring code coverage reports
  - name: 'ReportGenerator_Version'
    value: '4.0.4'

  # Specifies the version of the SonarQube scanner to use when performing statically analysis against this project.
  - name: 'SonarScanner_Version'
    value: '4.4.2'

  # Avoid caching NuGet packages each time a build runs on an Azure DevOps agent.
  # See more here: http://donovanbrown.com/post/Stop-wasting-time-during-NET-Core-builds.
  - name: 'DotNetSkipFirstTimeExperience'
    value: 1

  # Disable .NET Core telemetry.
  # See more here: https://docs.microsoft.com/en-us/dotnet/core/tools/telemetry#how-to-opt-out.
  - name: 'DotNetCliTelemetryOptOut'
    value: 1

  # Disable Core CLR tracing.
  - name: 'CoreHostTrace'
    value: 0

  # Represents the key of the project hosted on SonarCloud
  - name: 'CurrentProject.Sonar.ProjectKey'
    value: 'aspnet-core-logging'

# Define multiple jobs, one per supported OS.
# See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/process/multiple-phases?tabs=yaml&view=vsts.
#
# Will use job templates, since all supported operating systems will run the same jobs.
# See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=example#job-templates
# and here: https://docs.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=vsts.
jobs:
#- template: azure-pipelines.job-template.yml
#  parameters:
#    job:
#      name: linux
#      displayName: Build on Linux
#    pool:
#      vmImage: 'ubuntu-16.04'

#- template: azure-pipelines.job-template.yml
#  parameters:
#    job:
#      name: macOS
#      displayName: Build on macOS
#    pool:
#      vmImage: 'macOS-10.13'

- template: azure-pipelines.job-template.yml
  parameters:
    job:
      name: windows
      displayName: Build on Windows
    pool:
      vmImage: 'vs2017-win2016'