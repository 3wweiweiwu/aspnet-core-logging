# Build ASP.NET Core project using Azure Pipelines
# See more here: https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core?view=vsts.
# YAML schema reference: https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=vsts&tabs=schema.
name: build-any-commit

resources:
  repositories: 
  - repository: aspnet-core-logging
    type: github
    name: satrapu/aspnet-core-logging
    # The value of the "endpoint" element must match the service connection name 
    # declared in Project Settings > Service connections section of your Azure DevOps organization
    endpoint: satrapu

# Define multiple jobs, one per supported OS
# See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/process/multiple-phases?tabs=yaml&view=vsts.
jobs:
- job: windows
  displayName: Build on Windows
  continueOnError: true
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - script: 'dotnet build Todo.sln --configuration Release'
    name: build_app
    displayName: Build application
  - script: 'dotnet test ./Tests/TodoWebApp.IntegrationTests/TodoWebApp.IntegrationTests.csproj --configuration Release --logger "trx;LogFileName=TodoWebApp.IntegrationTests.TestResults.trx"'
    name: run_tests
    displayName: Run tests
  # Publish test results
  # See more here: https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/test/publish-test-results?view=vsts&tabs=yaml.
  - task: PublishTestResults@2
    displayName: Publish test results
    name: publish_test_results
    inputs:
      testResultsFormat: 'xUnit'
      testResultsFiles: 'TodoWebApp.IntegrationTests.TestResults.trx'
      mergeTestResults: true

#- job: linux
#  displayName: Build on Linux
#  continueOnError: true
#  pool:
#    vmImage: 'ubuntu-16.04'
#  steps:
#  - script: dotnet build ./Todo.sln --configuration Release
#    name: build-app
#    displayName: Build application
#  - script: dotnet test ./Tests/* --configuration Release --logger trx
#    name: run-tests
#    displayName: Run tests
#  - task: PublishTestResults@2
#    displayName: Publish test results
#    name: publish-test-results
#    inputs:
#      testResultsFormat: 'xUnit'
#      testResultsFiles: './Tests/**/TestResults/*.trx' 
#      mergeTestResults: true
#
#- job: macOS
#  displayName: Build on macOS
#  continueOnError: true
#  pool:
#    vmImage: 'macOS-10.13'
#  steps:
#  - script: dotnet build ./Todo.sln --configuration Release
#    name: build-app
#    displayName: Build application
#  - script: dotnet test ./Tests/* --configuration Release --logger trx
#    name: run-tests
#    displayName: Run tests
#
#  - task: PublishTestResults@2
#    displayName: Publish test results
#    name: publish-test-results
#    inputs:
#      testResultsFormat: 'xUnit'
#      testResultsFiles: './Tests/**/TestResults/*.trx' 
#      mergeTestResults: true